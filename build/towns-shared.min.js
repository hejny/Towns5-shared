var PRS$0=function(t,e){return t.__proto__={a:e},t.a===e}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(t,e){for(var r in e)e.hasOwnProperty(r)&&DP$0(t,r,GOPD$0(e,r));return t},SP$0=Object.setPrototypeOf||function(t,e){return PRS$0?t.__proto__=e:DP$0(t,"__proto__",{value:e,configurable:!0,enumerable:!1,writable:!0}),t},OC$0=Object.create;global.Towns={},module.exports=global.Towns;var T=global.Towns;T.Color=function(){"use strict";function t(t,e,r){var n=arguments[3];void 0===n&&(n=255),this.r=t,this.g=e,this.b=r,this.a=n}var e={},r={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),r.bounds=function(){this.r=Math.round(this.r),this.g=Math.round(this.g),this.b=Math.round(this.b),this.a=Math.round(this.a),this.r>255&&(this.r=255),this.r<0&&(this.r=0),this.g>255&&(this.g=255),this.g<0&&(this.g=0),this.b>255&&(this.b=255),this.b<0&&(this.b=0),this.a>255&&(this.a=255),this.a<0&&(this.a=0)},r.getCssColor=function(){return this.bounds(),255==this.a?"rgb("+this.r+", "+this.g+", "+this.b+")":"rgba("+this.r+", "+this.g+", "+this.b+", "+Math.round(this.a/255*100)/100+")"},r.getHex=function(){return this.bounds(),"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)},e.createFromHex=function(t){var e,r;if(r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,t=t.replace(r,function(t,e,r,n){return e+e+r+r+n+n}),e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))return new T.Color(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16));throw new Error("Error while creating T.Color from "+t)},MIXIN$0(t,e),MIXIN$0(t.prototype,r),e=r=void 0,t}(),T.Game=function(t,e,r){this.action_type_list=t,this.max_life_modifier=e,this.price_key_modifier=r},T.Game.prototype.getObjectPriceBases=function(t){var e=this,r=[];return"undefined"==typeof t.actions?[]:(t.actions.forEach(function(t){if("undefined"==typeof e.action_type_list[t.type])throw new Error("Unknown action type "+t.type);var n=e.action_type_list[t.type];for(var i in n.params){var o=n.params[i];if(typeof t.params[i]!=o)throw new Error("Param "+i+" should be "+o+" in action "+t.type)}var a=Math.ceil(n.price_base(t.params));if(0>a)throw new Error("Params in action "+t.type+" should not make this action negative");r.push(a)}),r)},T.Game.prototype.getObjectMaxLife=function(t){var e=this.getObjectPriceBases(t),r=e.reduce(function(t,e){return t+e},0);return r=this.max_life_modifier(r)},T.Game.prototype.getObjectPrices=function(t){var e=this.getObjectPriceBases(t),r=this,n=[];if("undefined"==typeof t.actions)return[];var i=r.getObjectDesignPrice(t);return t.actions.forEach(function(t,o){var a=r.action_type_list[t.type];a.price_resources_list.sort(function(t,e){return i.compare(t.clone().signum())-i.compare(e.clone().signum())});var s=a.price_resources_list[0].clone();s.multiply(e[o]),n.push(s)}),n},T.Game.prototype.getObjectPrice=function(t){var e=new T.Resources({}),r=this.getObjectPrices(t);return r.forEach(function(t){e.add(t)}),e.apply(this.price_key_modifier),e},T.Game.prototype.getObjectDesignPrice=function(t){if(!t.hasOwnProperty("design"))throw new Error("Object should have design!");if("model"!=t.design.type)throw new Error("Object should have design of type model!");var e=new T.Resources({});return model=new T.Model(t.design.data),linear_particles=model.getLinearParticles(),linear_particles.forEach(function(t){var r=t.size.x*t.size.y*t.size.z,n=t.material.split("_");n=n[0];var i={};i[n]=r,e.add(i)}),e},T.Game.ActionType=function(t,e,r,n,i){this.type=t,this.params=e,this.price_base=r,this.price_resources_list=n,this.perform=i};var A=T;A.MapGenerator=function(t,e,r,n){this.getZ=t,this.z_normalizing_table=e,this.biotope=r,this.virtualObjectGenerator=n},A.MapGenerator.prototype.getZMapCircle=function(t,e){for(var r=[],n=0;2*e>=n;n++){r[n]=[];for(var i=0;2*e>=i;i++)if(!(Math.pow(i-e+.5,2)+Math.pow(n-e+.5,2)>Math.pow(e,2))){var o=this.getZ(i-e+t.x,n-e+t.y);r[n][i]=this.z_normalizing_table[Math.floor(o*this.z_normalizing_table.length)]}}return r},A.MapGenerator.prototype.terrainMap=function(t){for(var e=[],r=0,n=t.length;n>r;r++){e[r]=[];for(var i=0;n>i;i++)"undefined"!=typeof t[r][i]&&(e[r][i]=this.biotope.getZTerrain(t[r][i]))}return e},A.MapGenerator.prototype.getMapArrayCircle=function(t,e){var r=this.getZMapCircle(t,e),n=this.terrainMap(r);return n},A.MapGenerator.prototype.convertMapArrayToObjects=function(t,e,r){for(var n=new T.Objects.Array,i=0;2*r>i;i++)for(var o=0;2*r>o;o++)if("undefined"!=typeof t[i][o]){var a=new T.Objects.Terrain(t[i][o]);a.x=e.x-r+o,a.y=e.y-r+i,n.push(a)}return n},A.MapGenerator.prototype.getPureMap=function(t,e){center_integer={x:Math.floor(t.x),y:Math.floor(t.y)};var r=this.getMapArrayCircle(center_integer,e),n=this.convertMapArrayToObjects(r,center_integer,e);return n},A.MapGenerator.prototype.getVirtualObjectsFromTerrainObjects=function(t){var e=this,r=[];return t.get1x1TerrainObjects().forEach(function(t){e.virtualObjectGenerator(t,r)}),r},A.MapGenerator.prototype.getCompleteObjects=function(t,e,r,n){"undefined"==typeof n&&(n=!0);var i=this.getPureMap(e,r);if(t.forEach(function(t){i.push(t)}),n){var n=this.getVirtualObjectsFromTerrainObjects(i);n.forEach(function(t){i.push(t)})}return i},T.MapGenerator=T.MapGenerator||{};var A=T.MapGenerator;A.Biotope=function(t){var e=0;t.forEach(function(t){e+=t.amount});var r=0;t.forEach(function(t){t.from=r/e,r+=t.amount}),this.terrains=t},A.Biotope.prototype.getZTerrain=function(t){for(var e=this.terrains.length-1;e>=0;e--)if(t>=this.terrains[e].from)return this.terrains[e].terrain};var A=T;A.Math={},A.Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},A.Math.baseLog=function(t,e){return Math.log(e)/Math.log(t)},A.Math.prettyNumber=function(t,e){e=e||2;var r=Math.ceil(T.Math.baseLog(10,t)),n=Math.pow(10,e-r);return t*=n,t=Math.round(t),t/=n},A.Math.angleDiff=function(t,e){var r=t-e,r=(r+180)%360-180;return r},A.Math.rad2deg=function(t){return t*(180/Math.PI)},A.Math.deg2rad=function(t){return t*(Math.PI/180)},A.Math.xy2dist=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},A.Math.xy2distDeg=function(t,e){var r={};return r.dist=this.xy2dist(t,e),r.deg=this.rad2deg(Math.atan2(e,t)),r},A.Math.distDeg2xy=function(t,e){var r=this.deg2rad(e),n={};return n.x=Math.cos(r)*t,n.y=Math.sin(r)*t,n},A.Math.xyRotate=function(t,e,r){var n=this.xy2dist(t,e),i=Math.atan2(e,t);i+=this.deg2rad(r);var o={};return o.x=Math.cos(i)*n,o.y=Math.sin(i)*n,o},A.Math.randomSeedPosition=function(t,e){return(Math.sin(Math.pow(e.x*e.y-t,2))+1)/2},A.Math.toFloat=function(t,e){return"undefined"==typeof e&&(e=0),"undefined"==typeof t?e:(t=parseFloat(t),isNaN(t)?e:t)},A.Math.toInt=function(t,e){return"undefined"==typeof t?e:(t=parseInt(t),isNaN(t)?e:t)},A.Math.bounds=function(t,e,r){return e>t?e:t>r?r:t},A.Math.lineCollision=function(t,e,r,n,i,o,a,s){var u=(r-t)*(s-o)-(n-e)*(a-i),c=(e-o)*(a-i)-(t-i)*(s-o),p=(e-o)*(r-t)-(t-i)*(n-e);if(0==u)y=!1;else var h=c/u,f=p/u,y=h>=0&&1>=h&&f>=0&&1>=f;return y},A.Math.blurXY=function(t,e){return function(r,n){var i=0,o=0;for(xx=r-e;xx<=r+e;xx++)for(yy=n-e;yy<=n+e;yy++)Math.pow(e,2)<Math.pow(xx-r,2)+Math.pow(yy-n,2)||(i+=t(xx,yy),o++);return i/o}},A.Math.bytesToSize=function(t){var e=["Bytes","KB","MB","GB","TB"];if(0==t)return"0 Byte";var r=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.round(t/Math.pow(1024,r),2)+" "+e[r]};var A=T;module.exports=Towns,A.Model=function(t){return"undefined"==typeof t?!1:(this.name=t.name,this.particles=t.particles,this.rotation=t.rotation,this.size=t.size,"undefined"==typeof this.rotation&&(this.rotation=0),void("undefined"==typeof this.size&&(this.size=1)))},A.Model.prototype.clone=function(){return new T.Model(JSON.parse(JSON.stringify(this)))},A.Model.prototype.addRotationSize=function(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=1),this.rotation+=t,this.size=this.size*e},A.Model.prototype.clone=function(){return new T.Model(JSON.parse(JSON.stringify(this)))},A.Model.prototype.range=function(t){if("xy"==t)return T.Math.xy2dist(this.range("x"),this.range("y")*this.size);var e,r,n=this.getLinearParticles(),i=!1,o=!1;for(var a in n)r=n[a].position[t],e=n[a].position[t]+n[a].size[t],i===!1&&(i=e),o===!1&&(o=r),e>i&&(i=e),o>r&&(o=r);return Math.abs(o-i)},A.Model.prototype.moveBy=function(t,e,r){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof r&&(r=0);for(var n in this.particles)this.particles[n].position.x+=t,this.particles[n].position.y+=e,this.particles[n].position.z+=r},A.Model.prototype.joinModelZ=function(t,e,n){var i=this.getLinearParticles(),o=t.getLinearParticles(),a=[0];for(var s in o){o[s].position.x+=e,o[s].position.y+=n;for(var u in i)Particles.collision2D(i[u],o[s])&&(r(i[u],o[s]),a.push(i[u].position.z+i[u].size.z))}var c=Math.max.apply(Math,a);return c},A.Model.prototype.joinModel=function(t,e,r){var n=this.joinModelZ(t,e,r);this.particles=[JSON.parse(JSON.stringify(this)),JSON.parse(JSON.stringify(t))],this.particles[1].position={x:e,y:r,z:n},this.rotation=0,this.size=1},A.Model.prototype.getDeepCopyWithoutLinks=function(){var t=this.clone(),e=function(t,r){for(var n in t){if(t[n].name==r)return t[n];if("undefined"!=typeof t[n].particles){var i=e(t[n].particles,r);if(i!==!1)return i}}return!1},r=function(n){for(var i in n){if("undefined"!=typeof n[i].link){var o=e(t.particles,n[i].link);if(0==o)throw new Error("Invalid link "+particle.link);o=JSON.parse(JSON.stringify(o)),"undefined"!=typeof n[i].rotation&&(o.rotation=n[i].rotation),"undefined"!=typeof n[i].size&&(o.size=n[i].size),"undefined"!=typeof n[i].position&&(o.position=n[i].position),n[i]=o}"undefined"!=typeof n[i].particles&&r(n[i].particles)}};return r(t.particles),t},A.Model.prototype.getLinearParticles=function(){var t=[],e=function(r,n,i,o){"undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i=0),"undefined"==typeof o&&(o=1),n===!1&&(n={x:0,y:0,z:0}),r.forEach(function(r){r.position||(r.position={x:0,y:0,z:0}),"undefined"==typeof r.rotation&&(r.rotation=0),"undefined"==typeof r.size&&(r.size=1);var a=T.Math.xy2distDeg(r.position.x,r.position.y);a.dist=a.dist*o,a.deg+=i;var s=T.Math.distDeg2xy(a.dist,a.deg);r.rotation+=i,r.position.x=s.x,r.position.y=s.y,r.position.z=r.position.z*o,r.position.x+=n.x,r.position.y+=n.y,r.position.z+=n.z,"number"==typeof r.size?r.size=r.size*o:(r.size.x=r.size.x*o,r.size.y=r.size.y*o,r.size.z=r.size.z*o),"undefined"!=typeof r.particles?e(r.particles,r.position,r.rotation,r.size):"undefined"!=typeof r.shape&&t.push(r)})},r=this.getDeepCopyWithoutLinks();return e(r.particles,!1,r.rotation,r.size),t},A.Model.prototype.filterPath=function(t){var e=this;if("undefined"==typeof t.forEach)throw r(t),new Error("Path is not correct array.");return t.forEach(function(t){e=e.particles[t]}),e},A.Model.prototype.filterPathSiblings=function(t){var e=this.getDeepCopyWithoutLinks(),n=e;if("undefined"==typeof t.forEach)throw r(t),new Error("Path is not correct array.");return t.forEach(function(t,e){var r=n.particles[t];n.particles=[r],n=r}),e},T.Model=T.Model||{};var A=T.Model;A.Particles={},A.Particles.cParams=function(t){return"undefined"==typeof t.skew&&(t.skew={}),"undefined"==typeof t.skew.z&&(t.skew.z={x:0,y:0}),"undefined"==typeof t.shape.top&&(t.shape.top=1),"undefined"==typeof t.shape.bottom&&(t.shape.bottom=1),"undefined"==typeof t.rotation&&(t.rotation=0),t},A.Particles.get3D=function(t){var e={};if(t=T.Model.Particles.cParams(t),"prism"!=t.shape.type)throw"Unknown particle shape "+t.shape.type;var r=t.position.x,n=t.position.y,i=t.position.z,o=t.size.x,a=t.size.y,s=t.size.z;e.points=[],e.polygons=[[],[]],e.polygons2D=[[],[]];for(var u=0;2>u;u++){if(0==u)var c=t.shape.bottom;else var c=t.shape.top;for(var p=0;p<t.shape.n;p++){if(is(t.shape.rotated)){var h=2-Math.cos(T.Math.deg2rad(180/t.shape.n)),f=o*(2*u-1);y=.5*a*Math.sin(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n)),l=.5*(s*Math.cos(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n))*h+s*Math.cos(T.Math.deg2rad(180/t.shape.n))*h)}else var f=.5*o*Math.cos(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n))*c+o*(u*t.skew.z.x),y=.5*a*Math.sin(p/t.shape.n*Math.PI*2+T.Math.deg2rad(180+180/t.shape.n))*c+a*(u*t.skew.z.y),l=s*u;var d=T.Math.xy2distDeg(f,y);d.deg+=t.rotation;var g=T.Math.distDeg2xy(d.dist,d.deg);f=g.x,y=g.y,e.points.push([r+f,n+y,i+l]),0==u&&(e.polygons[0].push(p+1),e.polygons[1].push(p+1+t.shape.n),e.polygons2D[0].push(p+1),e.polygons2D[1].push(p+1+t.shape.n),e.polygons.push([0!=p?p:t.shape.n,p+1,p+1+t.shape.n,(0!=p?p:t.shape.n)+t.shape.n]))}}return e},A.Particles.get2Dlines=function(t,e){var r=this.get3D(t),n=[],i=[r.polygons2D[e]];for(var o in i)for(var a=-1,s=i[o].length;s-1>a;a++){if(-1!=a)var u=a;else var u=s-1;var c=a+1;u=r.points[i[o][u]-1],c=r.points[i[o][c]-1],n.push([{x:u[0],y:u[1]},{x:c[0],y:c[1]}])}return n},A.Particles.collisionLinesDetect=function(t,e){for(var r in t)for(var n in e)if(T.Math.lineCollision(t[r][0].x,t[r][0].y,t[r][1].x,t[r][1].y,e[n][0].x,e[n][0].y,e[n][1].x,e[n][1].y))return!0;return!1},A.Particles.collision2D=function(t,e){var r=Particles.get2Dlines(t,1),n=Particles.get2Dlines(e,0),o=Particles.collisionLinesDetect(r,n);return o||(o=function(){var t=100;for(i=0;i<2;i++){if(0==i)var e=JSON.parse(JSON.stringify(n)),o=r[0];else var e=JSON.parse(JSON.stringify(r)),o=n[0];var a=JSON.parse(JSON.stringify(o)),s=JSON.parse(JSON.stringify(o)),u=o[1].x-o[0].x,c=o[1].y-o[0].y;a[0].x-=u*t,a[0].y-=c*t,s[1].x+=u*t,s[1].y+=c*t,a=[a],s=[s];var p=Particles.collisionLinesDetect(a,e),h=Particles.collisionLinesDetect(s,e);if(p&&h)return!0}return!1}()),o},T.Objects=T.Objects||{};var A=T.Objects;A.Array=function(t){this.objects=[],t instanceof Array&&t.forEach(this.push,this)},A.Array.prototype.getAll=function(){return this.objects},A.Array.prototype.forEach=function(){return this.objects.forEach.apply(this.objects,arguments)},A.Array.initInstance=function(t){if("building"==t.type)t=new T.Objects.Building(t);else if("terrain"==t.type)t=new T.Objects.Terrain(t);else if("story"==t.type)t=new T.Objects.Story(t);else{if("natural"!=t.type)throw new Error("Cant put item into Towns Objects Array because of unrecognized object type "+t.type);t=new T.Objects.Natural(t)}return t},A.Array.prototype.push=function(t){return this.objects.push(T.Objects.Array.initInstance(t))},A.Array.prototype.getById=function(t){if("string"!=typeof t)throw new Error("getById: id should be string");for(var e in this.objects)if(this.objects[e].id==t)return this.objects[e];return null},A.Array.prototype.setById=function(t,e){if("string"!=typeof t)throw new Error("setById: id should be string");for(var r in this.objects)if(this.objects[r].id==t)return this.objects[r]=T.Objects.Array.initInstance(e),!0;return!1},A.Array.prototype.removeId=function(t,e){if("string"!=typeof t)throw new Error("removeId: id should be string");for(var r in this.objects)if(this.objects[r].id==t)return this.objects.splice(r,1),!0;return!1},A.Array.prototype.filterTypes=function(){var t=new T.Objects.Array,e=Array.prototype.slice.call(arguments);return this.forEach(function(r){-1!=e.indexOf(r.type)&&t.push(r)}),t},A.Array.prototype.getMapOfTerrainCodes=function(t,e){for(var r=[],n=0;2*e>n;n++){r[n]=[];for(var i=0;2*e>i;i++)r[n][i]=!1}return this.objects.forEach(function(n){if("terrain"==n.type)if(1==n.design.data.size){var i=Math.floor(n.x-t.x+e),o=Math.floor(n.y-t.y+e);r[o][i]=n.getCode()}else for(var a=Math.floor(n.x-t.x+e-n.design.data.size),s=Math.ceil(n.x-t.x+e+n.design.data.size),u=Math.floor(n.y-t.y+e-n.design.data.size),c=Math.ceil(n.y-t.y+e+n.design.data.size),p=e+t.x-n.x,h=e+t.y-n.y,o=u;c>=o;o++)if("undefined"!=typeof r[o])for(var i=a;s>=i;i++)"undefined"!=typeof r[o][i]&&T.Math.xy2dist(i-p,o-h)<=n.design.data.size&&(r[o][i]=n.getCode())}),r},A.Array.prototype.get1x1TerrainObjects=function(){var t=new T.Objects.Array,e=this.filterTypes("terrain").getAll().reverse(),r={};return e.forEach(function(e){if(1==e.design.data.size){var n=e,i="x"+n.x+"y"+n.y;"undefined"==typeof r[i]&&(r[i]=!0,t.push(n))}else for(var o=Math.floor(-e.design.data.size),a=Math.ceil(e.design.data.size),s=Math.floor(-e.design.data.size),u=Math.ceil(e.design.data.size),c=s;u>=c;c++)for(var p=o;a>=p;p++)if(T.Math.xy2dist(p,c)<=e.design.data.size){var n=e.clone();n.design.data.size=1,n.x+=p,n.y+=c;var i="x"+n.x+"y"+n.y;"undefined"==typeof r[i]&&(r[i]=!0,t.push(n))}}),t},A.Array.prototype.getTerrainOnPosition=function(t){for(var e=this.objects.length-1;e>=0;e--)if("terrain"==this.objects[e].type&&this.objects[e].design.data.size<=t.getDistance(new T.Position(this.objects[e].x,this.objects[e].y)))return this.objects[e];return null},A.Array.prototype.getNearestTerrainPositionWithCode=function(t,e){var r=this.get1x1TerrainObjects(),n=-1,i=!1;return r.forEach(function(e){var r=e.getPosition().getDistance(t);(-1===n||n>r)&&(n=r,i=e)}),i===!1?null:i.getPosition()},T.Objects=T.Objects||{};var A=T.Objects;A.Object=function(){"use strict";function t(t){for(var e in t){var r=e;"_id"==r&&(r="id"),this[r]=t[e]}}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getPosition=function(){return new T.Position(this.x,this.y)},MIXIN$0(t.prototype,e),e=void 0,t}(),T.Objects=T.Objects||{};var A=T.Objects;A.Building=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=A.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var r={};return r.clone=function(){return new T.Objects.Building(JSON.parse(JSON.stringify(this)))},r.getModel=function(){return this.design.data instanceof T.Model||(this.design.data=new T.Model(this.design.data)),this.design.data},MIXIN$0(e.prototype,r),r=void 0,e}(),T.Objects=T.Objects||{};var A=T.Objects;A.Natural=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=A.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var r={};return r.clone=function(){return new T.Objects.Natural(JSON.parse(JSON.stringify(this)))},r.getCode=function(){return this.design.data.image},MIXIN$0(e.prototype,r),r=void 0,e}(),T.Objects=T.Objects||{};var A=T.Objects;A.Story=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=A.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var r={};return r.clone=function(){return new T.Objects.Story(JSON.parse(JSON.stringify(this)))},r.getMarkdown=function(){return this.content.data},MIXIN$0(e.prototype,r),r=void 0,e}(),T.Objects=T.Objects||{};var A=T.Objects;A.Terrain=function(t){"use strict";function e(){null!==t&&t.apply(this,arguments)}t=A.Object,PRS$0||MIXIN$0(e,t),null!==t&&SP$0(e,t),e.prototype=OC$0(null!==t?t.prototype:null,{constructor:{value:e,configurable:!0,writable:!0}}),DP$0(e,"prototype",{configurable:!1,enumerable:!1,writable:!1});var r={};return r.clone=function(){return new T.Objects.Terrain(JSON.parse(JSON.stringify(this)))},r.getCode=function(t){return this.design.data.image},r.getColor=function(){return this.design.data.color},MIXIN$0(e.prototype,r),r=void 0,e}();var A=T;A.Position3D=function(){"use strict";function t(t,e,r){"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=r)}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.toString=function(){return"["+this.x+","+this.y+","+this.z+"]"},MIXIN$0(t.prototype,e),e=void 0,t}();var A=T;A.Position=function(){"use strict";function t(t,e){"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}var e={};return DP$0(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e.getMoved=function(t,e){return new T.Position(this.x+t,this.y+e)},e.getDistance=function(t){return T.Math.xy2dist(t.x-this.x,t.y-this.y)},e.toString=function(){return"["+this.x+","+this.y+"]"},MIXIN$0(t.prototype,e),e=void 0,t}();var A=T;A.Resources=function(t){for(var e in t)"number"==typeof t[e]&&(this[e]=Math.ceil(t[e]))},A.Resources.newSingles=function(t){var e=[];for(var r in t)if("number"==typeof t[r]&&t[r]>0){var n={};n[r]=t[r],e.push(new T.Resources(n))}return e},A.Resources.prototype.clone=function(){return new T.Resources(this)},A.Resources.prototype.contains=function(t){for(var e in t){if("number"==typeof this[e])return!1;if(this[e]<t[e])return!1}return!0},A.Resources.prototype.add=function(t){for(var e in t)"undefined"==typeof this[e]&&(this[e]=0),"number"==typeof this[e]&&(this[e]+=t[e]);return this},A.Resources.prototype.multiply=function(t){for(var e in this)"number"==typeof this[e]&&(this[e]=Math.ceil(this[e]*t));return this},A.Resources.prototype.signum=function(t){for(var e in this)"number"==typeof this[e]&&(this[e]>0?this[e]=1:this[e]=0);return this},A.Resources.prototype.apply=function(t){for(var e in this)"number"==typeof this[e]&&(this[e]=t(this[e]));return this},A.Resources.prototype.extractKeys=function(){var t=[];for(var e in this)"number"==typeof this[e]&&t.push(e);return t},A.Resources.prototype.compare=function(t){var e=this,r=t,n=[];n=n.concat(e.extractKeys()),n=n.concat(r.extractKeys()),n=n.filter(function(t,e,r){return r.indexOf(t)===e});var i=0;for(var o in n){var a=n[o];val_A=e[a],val_B=r[a],"undefined"==typeof val_A&&(val_A=0),"undefined"==typeof val_B&&(val_B=0),i+=Math.pow(val_A-val_B,2)}return i=Math.sqrt(i)},A.Resources.prototype.remove=function(t){if(!this.contains(t))return!1;for(var e in t)this[e]-=t[e];return!0},A.Resources.prototype.toString=function(){var t=[];for(var e in this)"number"==typeof this[e]&&0!=this[e]&&t.push(this[e]+" "+e);return t.join(", ")},A.Resources.prototype.toHTML=function(){var t=[];for(var e in this)if("number"==typeof this[e]&&0!=this[e]){var r=Locale.get("resource",e),n=this[e];n=n.toLocaleString(),t.push('<div><img src="/media/image/resources/'+e+'.png" title="'+r+'" alt="'+r+'" >'+n+"</div>")}return t=t.join(" "),t='<div class="resources">'+t+"</div>"},T.World=T.World||{};var A=T.World;A.terrains=[new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:0,color:"#000000",size:1}},name:"temnota"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:1,color:"#337EFA",size:1}},name:"moře"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:2,color:"#545454",size:1}},name:"dlažba"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:3,color:"#EFF7FB",size:1}},name:"sníh/led"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:4,color:"#F9F98D",size:1}},name:"písek"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:5,color:"#878787",size:1}},name:"kamení"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:6,color:"#5A2F00",size:1}},name:"hlína"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:7,color:"#EFF7FB",size:1}},name:"sníh/led"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:8,color:"#2A7302",size:1}},name:"tráva(normal)"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:9,color:"#51F311",size:1}},name:"tráva(toxic)"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:10,color:"#535805",size:1}},name:"les"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:11,color:"#6aa2ff",size:1}},name:"řeka"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:12,color:"#8ABC02",size:1}},name:"tráva(jaro)"}),new T.Objects.Terrain({type:"terrain",design:{type:"terrain",data:{image:13,color:"#8A9002",size:1}},name:"tráva(pozim)"})],T.World=T.World||{};var A=T.World;A.mapGenerator=new T.MapGenerator(T.Math.blurXY(function(t,e){for(var r=100,n=0,i=0,o=0;13>o;o++){n+=Math.round(Math.pow(t*e-66,2))%(r+1),i+=r,t=Math.floor(t/3),e=Math.floor(e/3);var a=T.Math.xyRotate(t,e,57);t=a.x,e=a.y}return n/=i,0>n&&(n-=Math.floor(n)),n>1&&(n-=Math.floor(n)),n},2),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,1e-4,2e-4,2e-4,2e-4,2e-4,2e-4,2e-4,2e-4,2e-4,2e-4,2e-4,3e-4,3e-4,3e-4,3e-4,4e-4,5e-4,6e-4,7e-4,9e-4,9e-4,9e-4,.001,.0011,.0011,.0011,.0011,.0012,.0012,.0013,.0013,.0015,.0016,.0017,.0017,.0017,.002,.0021,.0023,.0024,.0028,.0031,.0033,.0034,.0037,.0044,.0045,.0047,.0049,.0049,.0051,.0054,.0058,.0061,.0062,.0064,.0067,.0071,.0074,.0075,.0078,.0082,.0083,.0084,.0088,.0092,.0097,.0102,.0107,.0112,.0123,.0131,.0139,.0147,.0149,.0153,.0163,.0168,.0175,.0181,.0188,.0193,.0203,.0212,.022,.0221,.0224,.0227,.0232,.0239,.0251,.0256,.0264,.0268,.0281,.0286,.0294,.0301,.0312,.0317,.0328,.0338,.035,.0356,.0368,.0377,.0387,.0402,.0409,.0422,.0438,.0446,.0458,.0475,.0486,.0502,.0513,.052,.0534,.0539,.0548,.056,.0568,.0578,.0595,.0607,.0624,.0634,.0644,.0664,.0677,.0694,.071,.072,.0734,.0747,.0757,.0767,.0785,.0794,.0805,.0817,.0826,.084,.0856,.087,.0883,.0898,.0915,.0923,.094,.0945,.0958,.0972,.0983,.0996,.1014,.1031,.1048,.1057,.1072,.1087,.1103,.1111,.1126,.1143,.1161,.1171,.1189,.1203,.1219,.1238,.1251,.1261,.1273,.129,.1303,.1315,.1324,.1331,.1341,.1355,.1368,.1387,.1397,.1408,.1427,.1437,.145,.1462,.1479,.1498,.1512,.1521,.1538,.1549,.1566,.1581,.1594,.1616,.1628,.1642,.1652,.1669,.1682,.17,.1713,.1727,.1742,.1764,.1782,.1795,.1817,.1835,.1851,.1859,.1865,.188,.1894,.191,.1921,.1935,.1947,.1962,.1975,.1986,.2001,.2011,.2022,.2028,.2046,.2058,.2069,.2079,.2093,.2105,.2122,.2135,.2145,.2154,.2163,.2171,.2183,.2193,.22,.2212,.2221,.2235,.2245,.2261,.2276,.2284,.2293,.2303,.2313,.2327,.2341,.2356,.2369,.2374,.2392,.2405,.242,.2435,.2449,.2466,.2481,.25,.2509,.2525,.2539,.2552,.2561,.2577,.2589,.2615,.2627,.2646,.2657,.2671,.269,.2706,.2719,.2732,.2743,.2764,.2779,.28,.2818,.2828,.2844,.2866,.288,.2892,.2912,.2926,.2938,.2963,.2979,.2996,.3013,.3028,.3052,.3066,.3077,.3098,.312,.3142,.3159,.3173,.3194,.3213,.3231,.3258,.3281,.3297,.332,.3347,.3363,.3384,.3409,.3432,.3464,.3483,.35,.3528,.3564,.3592,.3624,.3651,.3687,.3708,.3732,.3755,.379,.3811,.3836,.3865,.3888,.3912,.3948,.3974,.3998,.4019,.4045,.4082,.4106,.4145,.4168,.4195,.4221,.4247,.4266,.4293,.4313,.4364,.439,.4432,.4467,.4498,.4531,.4553,.4588,.4614,.4654,.4689,.4725,.4765,.4786,.4813,.4857,.4898,.4931,.4975,.5013,.5058,.5102,.5134,.5177,.5224,.5252,.5292,.5327,.5366,.5404,.5433,.5484,.5514,.5548,.5591,.5624,.5661,.5702,.5745,.5791,.5832,.5869,.5914,.5954,.6003,.6041,.6087,.6126,.6173,.6215,.6263,.6304,.6348,.6383,.6414,.6452,.6494,.6525,.6563,.6604,.6647,.6691,.672,.6752,.6806,.6839,.6879,.6916,.6961,.701,.7046,.7077,.7116,.7164,.7194,.7235,.7288,.7331,.7371,.7412,.7475,.7527,.7562,.761,.7647,.7685,.7722,.7761,.7809,.7852,.7893,.7931,.7961,.799,.8027,.8068,.8099,.8133,.8171,.8213,.8259,.8294,.8336,.8377,.8407,.8441,.8479,.8513,.8546,.858,.8611,.8636,.8679,.8715,.8751,.8782,.8813,.8846,.888,.891,.8943,.8967,.9004,.903,.9054,.9082,.9113,.9142,.9167,.9189,.9213,.9236,.9269,.9291,.9309,.9331,.9362,.9384,.9397,.9418,.944,.9455,.9474,.9489,.9505,.9533,.955,.9564,.9581,.96,.9614,.9626,.9641,.9658,.9679,.9688,.9706,.9718,.9731,.9744,.9757,.9767,.9785,.9796,.9806,.9817,.9827,.9832,.9838,.9846,.9851,.9859,.9864,.9867,.9876,.9885,.9887,.9891,.9898,.9902,.9912,.9913,.9917,.9922,.9928,.9931,.9932,.9932,.9938,.9941,.9943,.9947,.9954,.996,.9961,.9961,.9962,.9965,.9966,.9969,.997,.9972,.9974,.9975,.9976,.998,.998,.9981,.9981,.9986,.9987,.9989,.999,.9992,.9992,.9992,.9994,.9995,.9995,.9996,.9996,.9996,.9996,.9997,.9997,.9997,.9997,.9997,.9998,.9998,.9998,.9999,.9999,.9999,.9999,.9999,.9999,.9999,.9999,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],new T.MapGenerator.Biotope([{amount:120,terrain:A.terrains[1]},{amount:40,terrain:A.terrains[11]},{amount:30,terrain:A.terrains[4]},{amount:20,terrain:A.terrains[12]},{amount:40,terrain:A.terrains[9]},{amount:20,terrain:A.terrains[8]},{amount:20,terrain:A.terrains[10]},{amount:50,terrain:A.terrains[4]},{amount:10,terrain:A.terrains[13]},{amount:20,terrain:A.terrains[5]},{amount:60,terrain:A.terrains[3]},{amount:10,terrain:A.terrains[10]},{amount:60,terrain:A.terrains[7]},{amount:10,terrain:A.terrains[5]}]),function(t,e){"terrain"==t.type&&(5==t.design.data.image?e.push({x:t.x,y:t.y,type:"natural",design:{type:"natural",data:{image:"rock"+Math.floor(6*T.Math.randomSeedPosition(1,{x:t.x,y:t.y}))%6+"dark"+Math.floor(4*T.Math.randomSeedPosition(2,{x:t.x,y:t.y}))%4,size:.5+1*T.Math.randomSeedPosition(5,{x:t.x,y:t.y})}}}):10==t.design.data.image&&e.push({x:t.x,y:t.y,type:"natural",design:{type:"natural",data:{image:"tree"+Math.floor(10*T.Math.randomSeedPosition(3,{x:t.x,y:t.y}))%10,size:1+T.Math.randomSeedPosition(6,{x:t.x,y:t.y})/2}}}))}),T.World=T.World||{};var A=T.World,K=.05;A.game=new T.Game({defense:new T.Game.ActionType("passive",{defense:"number"},function(t){return 800*t.defense*K},T.Resources.newSingles({wood:2,clay:2,stone:1,iron:0})),regenerate:new T.Game.ActionType("passive",{regenerate:"number"},function(t){return 1/t.regenerate*3600*K},T.Resources.newSingles({wood:4,clay:2,stone:2,iron:2})),repair:new T.Game.ActionType("active",{repair:"number"},function(t){return 1/(t.repair/100)*1e3*K},T.Resources.newSingles({wood:4,clay:2,stone:3,iron:4}),function(t,e){}),mine:new T.Game.ActionType("passive",{resource:"string",amount:"number"},function(t){return 3600*t.amount*K},T.Resources.newSingles({wood:3,clay:2,stone:2,iron:4})),attack:new T.Game.ActionType("active",{distance:"number",strength:"number",rounds:"number",cooldown:"number"},function(t){return Math.pow(t.distance,2)*t.strength*t.rounds*(1/t.cooldown)*100*K},T.Resources.newSingles({wood:2,clay:0,stone:3,iron:2}),function(t,e){}),move:new T.Game.ActionType("active",{speed:"number"},function(t){return 10*Math.pow(t.speed,2)*K},T.Resources.newSingles({wood:2,clay:0,stone:0,iron:1}),function(t,e){}),throughput:new T.Game.ActionType("passive",{throughput:"number"},function(t){return 10*Math.pow(t.throughput/100,2)*K},T.Resources.newSingles({wood:2,clay:3,stone:1,iron:0}))},T.Math.prettyNumber,T.Math.prettyNumber);